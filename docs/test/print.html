<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cardano Deposit Wallet (test)</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Intro</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/mithril.html"><strong aria-hidden="true">1.1.</strong> Mithril Installation</a></li><li class="chapter-item expanded "><a href="installation/package.html"><strong aria-hidden="true">1.2.</strong> Package Installation</a></li><li class="chapter-item expanded "><a href="installation/docker.html"><strong aria-hidden="true">1.3.</strong> Docker Installation</a></li></ol></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">2.</strong> Examples</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">3.</strong> Usage</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">4.</strong> API</a></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">5.</strong> Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="design/problem.html"><strong aria-hidden="true">5.1.</strong> Problem statement</a></li><li class="chapter-item expanded "><a href="design/requirements.html"><strong aria-hidden="true">5.2.</strong> Requirements</a></li><li class="chapter-item expanded "><a href="design/specification.html"><strong aria-hidden="true">5.3.</strong> Specification</a></li><li class="chapter-item expanded "><a href="design/implementation.html"><strong aria-hidden="true">5.4.</strong> Implementation</a></li></ol></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">6.</strong> Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cardano Deposit Wallet (test)</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>üöß Work In Progress ‚Äî DO NOT USE in production üöß</p>
<p>The Cardano Deposit Wallet is a full-node wallet targeting businesses that need to track the origin of incoming payments ("deposits").</p>
<p>This page documents the Cardano Deposit Wallet software.</p>
<p>Use the sidebar for navigation.</p>
<ul>
<li><a href="./installation.html">Installation</a> ‚Äî Installation instructions. You need to do this in order to run the software.</li>
<li><a href="./examples.html">Examples</a> ‚Äî Usage examples. Read this to get started.</li>
<li><a href="./usage.html">Usage</a> ‚Äî User manual for the software.</li>
<li><a href="./api.html">API</a> ‚Äî API reference.</li>
<li><a href="./specifications.html">Specifications</a> ‚Äî Formal specifications of the wallet functionality. Read this for a precise understanding of what the wallet does and does not do.</li>
<li><a href="./contributing.html">Contributing</a> ‚Äî Information for people who want to work with and contribute to the code.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="system-prerequisites"><a class="header" href="#system-prerequisites">System Prerequisites</a></h2>
<p>This is a full node experience, so all the caveats of running a full node apply.</p>
<p>In particular, for <code>mainnet</code> you will need:</p>
<ul>
<li>24 GB RAM (UTxO set is still in memory)</li>
<li>250 GB disk space (Transaction history is stored in full)</li>
<li>4 CPU cores (for syncing)</li>
</ul>
<p>But for <code>preprod</code>, you can get away with:</p>
<ul>
<li>2 GB RAM</li>
<li>5 GB disk space</li>
<li>2 CPU cores</li>
</ul>
<p>You will need some tools to complete the installation:</p>
<ul>
<li>jq</li>
<li>wget</li>
<li>curl</li>
<li>tar</li>
<li>screen</li>
<li>a working browser</li>
</ul>
<p>Nix users can run a shell with all the tools:</p>
<pre><code class="language-bash">nix-shell -p jq wget gnutar screen curl
</code></pre>
<p>or</p>
<pre><code class="language-bash">nix shell nixpkgs#jq nixpkgs#wget nixpkgs#gnutar nixpkgs#screen nixpkgs#curl
</code></pre>
<blockquote>
<p>We are going to use the preprod network in these instructions.
Small changes are needed to run on other networks.</p>
</blockquote>
<h2 id="create-a-directory-for-the-node-state-or-use-the-current-directory"><a class="header" href="#create-a-directory-for-the-node-state-or-use-the-current-directory">Create a directory for the node state or use the current directory</a></h2>
<pre><code class="language-bash node-db directory">NODE_DB=${NODE_DB:-$(pwd)/node-db}
export NODE_DB
mkdir -p "$NODE_DB"
rm -rf "$NODE_DB/preprod"
</code></pre>
<p>Now you have two choices on how to proceed:</p>
<h2 id="use-a-package-for-your-system"><a class="header" href="#use-a-package-for-your-system">Use a package for your system.</a></h2>
<p>Not all platforms are supported, but we have packages for <code>linux64</code>, <code>macos-silicon</code>, and <code>macos-intel</code>.</p>
<ul>
<li><a href="./installation/package.html">Using a platform package</a>. As we do not ship for Windows, you will have to use a Docker solution.</li>
</ul>
<h2 id="using-a-docker-image"><a class="header" href="#using-a-docker-image">Using a docker image</a></h2>
<p>The Docker image is built through the Nix package manager and has no base image.</p>
<ul>
<li><a href="./installation/docker.html">Using a docker image</a></li>
</ul>
<h2 id="unpack-the-wallet-package"><a class="header" href="#unpack-the-wallet-package">Unpack the wallet package</a></h2>
<p>Once the <code>WALLET_PACKAGE</code> is set, you can unpack it.</p>
<pre><code class="language-bash explode package">tar xvzf "$WALLET_PACKAGE" &gt; /dev/null
WALLET_DIR=$(pwd)
export WALLET_DIR
export PATH=$WALLET_DIR:$PATH
</code></pre>
<h2 id="node-database-initialization"><a class="header" href="#node-database-initialization">Node database initialization</a></h2>
<p>It is recommended to retrieve the node state from Mithril to avoid long waiting times.</p>
<p><a href="./installation/mithril.html">Mithril node database setup</a></p>
<h2 id="manage-processes"><a class="header" href="#manage-processes">Manage processes</a></h2>
<p>We are going to use <code>screen</code> to keep the processes running in the background, but you can use any other tool you prefer.</p>
<p>If you are using these instructions as a script, you should install cleanups to ensure the screen sessions are closed.</p>
<p>Otherwise, you can skip the next step and clean up the screen sessions manually at the end.</p>
<pre><code class="language-bash install cleanups">cleanup() {
    screen -S "$NODE_SESSION" -X quit || true
    screen -S "$WALLET_SESSION" -X quit || true
}
trap cleanup EXIT
trap cleanup SIGINT
</code></pre>
<h2 id="start-the-node"><a class="header" href="#start-the-node">Start the node</a></h2>
<p>Now you can start the node that comes bundled with the wallet:</p>
<pre><code class="language-bash start node">NODE_SESSION="node-session-$(shuf -i 1000000-9999999 -n 1)"
NODE_CONFIGS="$WALLET_DIR/configs/preprod"
export NODE_CONFIGS
screen -dmS "$NODE_SESSION" cardano-node run \
    --config "$NODE_CONFIGS/config.json" \
    --database-path "$NODE_DB/preprod" \
    --socket-path "$NODE_DB/preprod/node.socket" \
    --topology "$NODE_CONFIGS/topology.json"
</code></pre>
<p>You can observe the node logs with:</p>
<pre><code class="language-bash">screen -r "$NODE_SESSION"
</code></pre>
<p>Detach from the screen with <code>Ctrl-a d</code>.</p>
<h2 id="start-the-wallet"><a class="header" href="#start-the-wallet">Start the wallet</a></h2>
<p>Now you can start the wallet:</p>
<pre><code class="language-bash start wallet">WALLET_SESSION="wallet-session-$(shuf -i 1000000-9999999 -n 1)"
DEPOSIT_PORT=$(shuf -i 1024-65000 -n 1)
export DEPOSIT_PORT
LEGACY_PORT=$(shuf -i 1024-65000 -n 1)
screen -dmS "$WALLET_SESSION" cardano-wallet serve \
    --node-socket "$NODE_DB/preprod/node.socket" \
    --testnet "$NODE_CONFIGS/byron-genesis.json" \
    --ui-deposit-port "$DEPOSIT_PORT" \
    --port "$LEGACY_PORT"
</code></pre>
<blockquote>
<p>At the moment, the legacy port is required even if we are not using it. Once the deposit wallet is extracted from the shelley wallet code-base, the legacy port will be removed.
You can observe the wallet logs with:</p>
</blockquote>
<pre><code class="language-bash">screen -r "$WALLET_SESSION"
</code></pre>
<p>Detach from the screen with <code>Ctrl-a d</code>.</p>
<h2 id="test-the-web-ui"><a class="header" href="#test-the-web-ui">Test the web UI</a></h2>
<p>Use <code>curl</code> to check if the UI is up</p>
<pre><code class="language-bash test home page">sleep 10
curl -s "http://localhost:$DEPOSIT_PORT" &gt; /dev/null
</code></pre>
<h2 id="open-the-web-ui-with-your-browser"><a class="header" href="#open-the-web-ui-with-your-browser">Open the web UI with your browser</a></h2>
<p>Now you can connect to the web UI with:</p>
<pre><code class="language-bash open web ui">xdg-open "http://localhost:$DEPOSIT_PORT"
</code></pre>
<h2 id="cleanup-screen-sessions"><a class="header" href="#cleanup-screen-sessions">Cleanup screen sessions</a></h2>
<p>Clean up the screen sessions using:</p>
<pre><code class="language-bash clean up">screen -S "$NODE_SESSION" -X quit
screen -S "$WALLET_SESSION" -X quit
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="download-the-mithril-executable"><a class="header" href="#download-the-mithril-executable">Download the Mithril executable</a></h2>
<pre><code class="language-bash download mithril">case $PACKAGED_FOR in
    linux64)
        MITHRIL_PLATFORM=linux-x64
        ;;
    macos-silicon)
        MITHRIL_PLATFORM=macos-arm64
        ;;
    macos-intel)
        MITHRIL_PLATFORM=macos-x64
        ;;
    *)
        echo "Unsupported platform: $PACKAGED_FOR"
        exit 1
        ;;
esac
LATEST_MITHRIL=$(curl -s https://api.github.com/repos/input-output-hk/mithril/releases/latest | jq -r .tag_name)
MITHRIL_NAME=mithril-$LATEST_MITHRIL-$MITHRIL_PLATFORM
wget -q https://github.com/input-output-hk/mithril/releases/download/$LATEST_MITHRIL/$MITHRIL_NAME.tar.gz
MITHRIL_DIR=$(pwd)/$MITHRIL_NAME
mkdir -p "$MITHRIL_DIR"
tar xvzf "$MITHRIL_NAME.tar.gz" -C "$MITHRIL_DIR" &gt; /dev/null
rm -f "$MITHRIL_NAME.tar.gz"
export PATH="$MITHRIL_DIR":$PATH
</code></pre>
<p>Test that mithril is installed correctly by running <code>mithril --version</code>.</p>
<pre><code class="language-bash test mithril">mithril --version
</code></pre>
<blockquote>
<p>NixOS will refuse to run Mithril unless <code>programs.nix-ld.enable = true;</code> is in the configuration.</p>
</blockquote>
<h2 id="populate-the-node-state-with-preprod-data"><a class="header" href="#populate-the-node-state-with-preprod-data">Populate the node state with preprod data</a></h2>
<pre><code class="language-bash populate preprod">export AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator
export GENESIS_VERIFICATION_KEY=5b3132372c37332c3132342c3136312c362c3133372c3133312c3231332c3230372c3131372c3139382c38352c3137362c3139392c3136322c3234312c36382c3132332c3131392c3134352c31332c3233322c3234332c34392c3232392c322c3234392c3230352c3230352c33392c3233352c34345d
digest=$(mithril-client cdb snapshot list --json | jq -r .[0].digest)
(cd "${NODE_DB}" &amp;&amp; mithril-client cdb download "$digest" &amp;&amp; mv db preprod)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get-a-usable-cardano-deposit-wallet-package"><a class="header" href="#get-a-usable-cardano-deposit-wallet-package">Get a usable cardano-deposit-wallet package</a></h1>
<p>To use the following instructions you will need to set <code>PACKAGED_FOR</code> to the platform you are using:</p>
<pre><code class="language-bash">export PACKAGED_FOR=linux64
</code></pre>
<pre><code class="language-bash">export PACKAGED_FOR=macos-silicon
</code></pre>
<pre><code class="language-bash">export PACKAGED_FOR=macos-intel
</code></pre>
<p>Now you can choose to download the latest version of the cardano-deposit-wallet tarball or use a local package or build the package locally.</p>
<h2 id="download-the-latest-version-of-the-cardano-deposit-wallet-tarball-or-use-a-local-package"><a class="header" href="#download-the-latest-version-of-the-cardano-deposit-wallet-tarball-or-use-a-local-package">Download the latest version of the cardano-deposit-wallet tarball or use a local package</a></h2>
<pre><code class="language-bash download package">WALLET_VERSION=$(curl -s https://api.github.com/repos/cardano-foundation/cardano-deposit-wallet/releases/latest | jq -r .tag_name)
WALLET_PACKAGE=cardano-deposit-wallet-$WALLET_VERSION-$PACKAGED_FOR.tar.gz
wget -q https://github.com/cardano-foundation/cardano-deposit-wallet/releases/download/$WALLET_VERSION/$WALLET_PACKAGE
export WALLET_PACKAGE
</code></pre>
<p>Alternatively</p>
<h2 id="build-the-package-locally"><a class="header" href="#build-the-package-locally">Build the package locally</a></h2>
<p>Set the <code>FLAKE</code> variable if you are working on a local clone, or leave it as it is to use the GitHub repository directly at main branch.</p>
<p>To compile different branches directly from the repository, you can set <code>REF</code> to the branch name.
To compile different commits directly from the repository, you can set <code>REV</code> to the commit hash.</p>
<p>You may want to override the <code>SYSTEM</code> variable if you are cross-compiling on the mac.</p>
<p><code>SYSTEM</code> can be set to <code>x86_64-darwin</code>, or <code>aarch64-darwin</code>. If not set it will default to
the current system.</p>
<pre><code class="language-bash build package">REPOSITORY="github:cardano-foundation/cardano-deposit-wallet"

if [ -z "${REF:-}" ]; then
    DEFAULT_FLAKE_URL="$REPOSITORY"
elif [ -z "${REV:-}" ]; then
    DEFAULT_FLAKE_URL="$REPOSITORY?ref=$REF"
else
    DEFAULT_FLAKE_URL="$REPOSITORY?rev=$REV"
fi

FLAKE=${FLAKE:-$DEFAULT_FLAKE_URL}

if [ -z "${SYSTEM:-}" ]; then
    SYSTEM_FLAG=""
else
    SYSTEM_FLAG="--system $SYSTEM"
fi
VERSION=$(nix eval --raw $FLAKE#version)
export WALLET_PACKAGE="result/cardano-deposit-wallet-$VERSION-$PACKAGED_FOR.tar.gz"
nix build $SYSTEM_FLAG $FLAKE#$PACKAGED_FOR.package
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><p>TODO</p>
<div style="break-before: page; page-break-before: always;"></div><p>TODO</p>
<div style="break-before: page; page-break-before: always;"></div><p>TODO</p>
<div style="break-before: page; page-break-before: always;"></div><p>API is not yet active.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="problem-origin-of-incoming-payments"><a class="header" href="#problem-origin-of-incoming-payments">Problem: Origin of incoming payments</a></h1>
<p>The main goal of the <a href="https://github.com/cardano-foundation/cardano-deposit-wallet">Cardano Deposit Wallet</a> is to offer a solution for the following problem:</p>
<h1 id="problem-statement"><a class="header" href="#problem-statement">Problem statement</a></h1>
<p>Some wallet users, typically businesses, would like to identify the origin of incoming payments, typically from their customers.</p>
<h1 id="status-quo"><a class="header" href="#status-quo">Status Quo</a></h1>
<h2 id="solution-assign-one-address-to-one-customer"><a class="header" href="#solution-assign-one-address-to-one-customer">Solution: Assign one address to one customer</a></h2>
<p>The most commonly used solution to tracking the origin of incoming payments is the following:</p>
<ul>
<li>
<p>The customer creates an account with the business.</p>
</li>
<li>
<p>The business generates a unique address and associates it with this customer account.</p>
</li>
<li>
<p>Any incoming payment on that address is treated as originating from that customer.</p>
</li>
</ul>
<p>The <a href="https://github.com/cardano-foundation/cardano-deposit-wallet">Cardano Deposit Wallet</a> implements this solution.</p>
<p>The <a href="https://github.com/cardano-foundation/cardano-wallet">cardano-wallet</a> software <em>lacks</em> explicit support for this solution, but it is still often used for this purpose. See below.</p>
<h3 id="user-centralized-cryptocurrency-exchanges-cex"><a class="header" href="#user-centralized-cryptocurrency-exchanges-cex">User: Centralized Cryptocurrency Exchanges (CEX)</a></h3>
<p>Exchanges enable users to trade cryptocurrencies for both crypto and fiat currencies.</p>
<p>Typically, CEXes keep track of one account for each customer. A customer can deposit ADA in their account (‚Äútop up‚Äù) by sending it to a Cardano address that the Exchange has associated with and communicated to the customer.</p>
<p>CEXes use various wallet setups:</p>
<ul>
<li>Single wallet for both deposits and withdrawals.</li>
<li>Two wallets: one for deposits, the other one for withdrawals.</li>
</ul>
<p>In both cases, the wallet responsible for accepting deposits tracks the addresses at which the deposit was made.</p>
<h3 id="user-small-merchants"><a class="header" href="#user-small-merchants">User: Small merchants</a></h3>
<p>Small online stores want to know when they receive ADA from a customer who placed an order, so that they can deliver the goods.</p>
<p>For example, here is a feature request for <a href="https://github.com/cardano-foundation/cardano-wallet">cardano-wallet</a>:</p>
<ul>
<li><a href="https://github.com/cardano-foundation/cardano-wallet/issues/2921">Feature to request additional addresses for a wallet #2921</a></li>
</ul>
<h2 id="support-in-cardano-wallet"><a class="header" href="#support-in-cardano-wallet">Support in cardano-wallet</a></h2>
<p><a href="https://github.com/cardano-foundation/cardano-wallet">Cardano-wallet</a> currently <strong>lacks</strong> explicit support for the type of usage described above. Specifically,</p>
<ul>
<li>The API documentation for Byron wallets and Shelley wallets implicitly allows funds to be moved between addresses ‚Äî there is no guarantee that funds sent to a wallet address originate from outside the wallet, they could come from the wallet itself!</li>
</ul>
<p>In practice, people use <a href="https://github.com/cardano-foundation/cardano-wallet">cardano-wallet</a> to track  funds incoming at particular addresses anyway, typically by inspecting the transaction history.</p>
<p>Besides the fundamental limitation above, using <a href="https://github.com/cardano-foundation/cardano-wallet">cardano-wallet</a> in this way has additional drawbacks:</p>
<p>Byron-style wallets have the following drawbacks:</p>
<ul>
<li>Addresses that have been created and imported cannot be restored from a single seed phrase.</li>
</ul>
<ul>
<li>
<p>The Base58 encoding used for Byron addresses tolerates less errors than Bech32, making loss of funds more likely for customers.</p>
</li>
<li>
<p>Address generation relies on implementation details of Haskell‚Äôs <code>StdGen</code> pseudorandom number generator.</p>
</li>
</ul>
<p>Shelley-style wallet has the following drawbacks:</p>
<ul>
<li>
<p>Making a transaction to generate new addresses incurs a transaction fee.</p>
</li>
<li>
<p>Wallets with an address gap ‚â† 20 do not comply with the BIP-44 standard for account discovery; they cannot be fully restored without knowledge of the address gap.</p>
</li>
</ul>
<h1 id="alternative-solutions"><a class="header" href="#alternative-solutions">Alternative solutions</a></h1>
<p>The problem statement could also be addressed by other means. For example:</p>
<ul>
<li>
<p>Transaction metadata could be augmented with identifying information about the origin of incoming payments.</p>
</li>
<li>
<p>Identifying information could be added to the addresses.</p>
</li>
</ul>
<h2 id="solution-transaction-metadata"><a class="header" href="#solution-transaction-metadata">Solution: Transaction metadata</a></h2>
<p>In traditional banking, transaction metadata is typically used to identify the origin of an incoming payment.</p>
<p>Also, for some cryptocurrencies, Exchanges do a single address and distinguish users by transaction metadata. This is the case for Kraken and the <a href="https://en.wikipedia.org/wiki/Stellar_(payment_network)">Stellar Lumens</a> blockchain.</p>
<p>However, the notion of ‚Äúone address ‚Äî one customer‚Äù appears to be established for ADA by now, probably also because current user interfaces (such as Daedalus) lack good ways to add transaction metadata.</p>
<h2 id="solution-identity-from-sender-addresses"><a class="header" href="#solution-identity-from-sender-addresses">Solution: Identity from sender addresses</a></h2>
<p>One could require customers to send money from a specific address. However, that would require a feature where the user wallet is able to send from a specific address. To our knowledge, such a feature has not been implemented, and it seems to interfere with intentional anonymity of addresses.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements-deposit-wallet"><a class="header" href="#requirements-deposit-wallet">Requirements: Deposit Wallet</a></h1>
<h1 id="synopsis"><a class="header" href="#synopsis">Synopsis</a></h1>
<p>This documents describes high-level requirements on the <a href="https://github.com/cardano-foundation/cardano-deposit-wallet">Cardano Deposit Wallet</a>.</p>
<p>The <a href="https://github.com/cardano-foundation/cardano-deposit-wallet">Cardano Deposit Wallet</a> is a full-node wallet targeting businesses that need to track the origin of incoming payments ("deposits").</p>
<p>Such a wallet is useful to businesses who want to match incoming payments to customers. The matching works as follows:</p>
<ul>
<li>The customer creates an account with the business.</li>
<li>In the wallet, the business generates a unique address and associates it with this customer account.</li>
<li>Any incoming payment on that address is treated as originating from that customer.</li>
</ul>
<h1 id="motivation"><a class="header" href="#motivation">Motivation</a></h1>
<p>See <a href="design/./problem.html">Problem statement</a>.</p>
<h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<h2 id="synopsis-1"><a class="header" href="#synopsis-1">Synopsis</a></h2>
<p>Compared to <a href="https://github.com/cardano-foundation/cardano-wallet">cardano-wallet</a>, the Deposit Wallet</p>
<ul>
<li>
<p>Officially supports a mapping between addresses to customers.</p>
</li>
<li>
<p>Improves performance when handling many addresses and large UTxO sets.</p>
</li>
<li>
<p>Supports a larger number of customers (up to 2¬≥¬π ~ 2.1 Billion) in a single wallet.</p>
</li>
<li>
<p>Uses the Bech32 encoding for customer addresses, which is more resilient against spelling mistakes.</p>
</li>
<li>
<p>Basic User Interface for Wallet Usability and Demonstration.</p>
</li>
</ul>
<h2 id="details"><a class="header" href="#details">Details</a></h2>
<h3 id="main"><a class="header" href="#main">Main</a></h3>
<p><strong>Known customers</strong>:</p>
<ul>
<li>
<p>The wallet maintains a one-to-one mapping between customers and addresses.</p>
</li>
<li>
<p>Customers are represented as numerical indices starting at <code>0</code>.</p>
</li>
<li>
<p>The maximum number of customers is at leaset 2¬≥¬π ~ 2.1 Billion.</p>
</li>
<li>
<p>Addresses are encoded using Bech32, which is more resilient against spelling mistakes.</p>
</li>
<li>
<p>Addresses are derived deterministically from a public key using <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a>-style key derivation.</p>
</li>
</ul>
<p>Incoming transactions:</p>
<ul>
<li>
<p>A deposit made at an address is treated as originating from the corresponding customer.</p>
</li>
<li>
<p>We can <strong>query</strong> the wallet for a recent history of deposits made by each known customer.</p>
</li>
</ul>
<p>Outgoing transactions:</p>
<ul>
<li>
<p>Outgoing funds are not distinguished by customer ‚Äî once funds have gone into the wallet, they are all part of a single wallet balance.</p>
</li>
<li>
<p>A transaction created by the wallet does <strong>not send</strong> funds to a <strong>known customer</strong> unless the wallet user explicitly wants that customer as payment destination.</p>
</li>
</ul>
<p>Signatures:</p>
<ul>
<li>
<p>The wallet stores a public key from which customer addresses are derived deterministically.</p>
</li>
<li>
<p>Optionally, the wallet stores a private key in order to sign outgoing transactions. This private key is encrypted with a passphrase.</p>
</li>
</ul>
<h3 id="technical"><a class="header" href="#technical">Technical</a></h3>
<p>Incoming transactions:</p>
<ul>
<li>
<p>Rollbacks of the blockchain are supported and do not cause an inconsistent wallet state.</p>
</li>
<li>
<p>The query for the history of deposits is atomic with respect to rollbacks.</p>
</li>
<li>
<p>Variant queries for the history of deposits are supported</p>
</li>
</ul>
<p>Outgoing transactions:</p>
<ul>
<li>
<p>The wallet can create a valid transaction if sufficient funds are available.</p>
</li>
<li>
<p>The wallet can sign the transaction if the optional private key is stored.</p>
</li>
</ul>
<p>API:</p>
<ul>
<li>
<p>REST API that exposes the wallet functionality</p>
</li>
<li>
<p>web UI for testing purposes</p>
</li>
</ul>
<h3 id="non-functional"><a class="header" href="#non-functional">Non-Functional</a></h3>
<p>Performance</p>
<ul>
<li>
<p>The wallet state is persisted to disk and does not need to be recreated by synchronizing to the blockchain.</p>
</li>
<li>
<p>Time-complexity of reading a new block should be</p>
<ul>
<li>
<p>logarithmic in the size of the address‚ÜîÔ∏écustomer mapping</p>
</li>
<li>
<p>logarithmic in the size of the current wallet UTxO</p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>Specification</p>
<div style="break-before: page; page-break-before: always;"></div><p>Implementation.</p>
<p>Miscellaneous details, such as</p>
<ul>
<li>Agda2hs. Status of specification.</li>
<li><code>Pure</code>, <code>IO</code>, <code>REST</code>, and <code>HTTP</code> modules.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
